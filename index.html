<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="wittepeper"/>
    <link href="https://fonts.googleapis.com/css?display=swap&amp;family=PT+Serif:700,700italic" rel="stylesheet" type="text/css">
    <title>kortverhaal | Home</title>
    <style>
        body {
            background-color: #F3EFE4;
            color: #575757;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            line-height: 2;
            font-weight: 400;
            max-width: 34em;
            margin: 0 auto;
            padding: 0 1em;
        }
        h1 {
            color: #575757;
            font-family: 'PT Serif';
            font-size: 2.25em;
            line-height: 2;
            font-weight: 700;
        }
        textarea {
            width: 100%;
            font: 1em "PT Serif";
        }
        h1 a {
            color: #575757;
            text-decoration: none;
        }
        a {
            color: #575757;
        }
        p {
            color: #575757;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            line-height: 2;
            font-weight: 400;
        }
        blockquote {
            font-family: monospace;
            background: #EEE;
            margin: 0;
            padding: 1px 1em;
        }
        div#v {
            background: #fdf5e6;
            padding: 1em;
        }
    </style>
</head>
<body>
    <h1><a href="./">kortverhaal</a></h1>
    <p id="content"></p>
    <a id="editLink" style="float:right" href="#" onclick="showEditor()">edit</a>
    <div id="editor" style="display: none;">
        <label for="pageSelect">Edit Page:</label>
        <input type="text" id="pageSelect" placeholder="Enter page name" onchange="loadEditorContent()">
        <textarea id="editorContent" rows="25" placeholder="Syntax: #title, *i*, **b**, * or 1. list, > quote, [[page]], [name](url), ![img](url), --- line, !!! note."></textarea>
        <br>
        <input type="password" id="password" placeholder="pwd">
        <input type="submit" value="save" onclick="saveContent()">
    </div>
    <script>
        const PASSWORD_HASH = '2a15weKzeQC2XeWnnwxsBwe4ORvOoccoxJWzwLdk9OCs8O0EL09ZGa3W'; // Simulate hashed password
        let currentPage = 'home'; // Default page

        function showEditor() {
            document.getElementById('editor').style.display = 'block';
            document.getElementById('content').style.display = 'none';
            document.getElementById('pageSelect').value = currentPage;
            loadEditorContent();
        }

        function loadEditorContent() {
            const pageToEdit = document.getElementById('pageSelect').value || 'home';
            document.getElementById('editorContent').value = localStorage.getItem(pageToEdit) || '';
        }

        function saveContent() {
            const passwordInput = document.getElementById('password').value;
            const editorContent = document.getElementById('editorContent').value;
            const pageToSave = document.getElementById('pageSelect').value || 'home';

            // Simulated password check
            if (passwordInput === 'password123') { // Replace with your password logic
                localStorage.setItem(pageToSave, editorContent);
                location.hash = pageToSave;
                location.reload();
            } else {
                alert('Incorrect password');
            }
        }

        function parseMarkdown(text) {
            text = "\n" + text + "\n";
            const rules = [
                { regex: /\n(#+)(.*)/g, replacement: (match, p1, p2) => `<h${p1.length}>${p2.trim()}</h${p1.length}>` },
                { regex: /\n-{3,}/g, replacement: () => "<hr/>" },
                { regex: /!\[([^\[]+)\]\(([^\)]+)\)/g, replacement: (match, p1, p2) => `<img src='${p2}' alt='${p1}'>` },
                { regex: /\[([^\]]+)\]\(([^\)]+)\)/g, replacement: (match, p1, p2) => `<a href='${p2}'>${p1}</a>` },
                { regex: /\[\[([^\]]+)\]\]/g, replacement: (match, p1) => `<a href='#${p1}'>${p1}</a>` },
                { regex: /(\*\*)(.*?)\1/g, replacement: (match, p1, p2) => `<b>${p2}</b>` },
                { regex: /\n\*(.*)/g, replacement: (match, p1) => `<ul>\n\t<li>${p1.trim()}</li>\n</ul>` },
                { regex: /\n\-(.*)/g, replacement: (match, p1) => `<ul>\n\t<li>${p1.trim()}</li>\n</ul>` },
                { regex: /\n[0-9]+\.(.*)/g, replacement: (match, p1) => `<ol>\n\t<li>${p1.trim()}</li>\n</ol>` },
                { regex: /(\*)(.*?)\1/g, replacement: (match, p1, p2) => `<i>${p2}</i>` },
                { regex: /\n(&gt;|\>)(.*)/g, replacement: (match, p1, p2) => `<blockquote>${p2.trim()}</blockquote>` },
                { regex: /\n(&gt;|\!!!)(.*)/g, replacement: (match, p1, p2) => `<div id=v>${p2.trim()}</div>` },
                { regex: /\n([^\n]+)\n/g, replacement: (match, p1) => `<p>${p1.trim()}</p>` },
                { regex: /<\/ul>\s?<ul>/g, replacement: '' },
                { regex: /<\/ol>\s?<ol>/g, replacement: '' },
                { regex: /<\/blockquote><blockquote>/g, replacement: '<br>' }
            ];

            rules.forEach(rule => {
                text = text.replace(rule.regex, rule.replacement);
            });

            return text.trim();
        }

        function loadPage() {
            const hash = window.location.hash.substring(1);
            currentPage = hash || 'home';
            document.title = `kortverhaal | ${currentPage}`;
            const savedContent = localStorage.getItem(currentPage);
            if (savedContent) {
                document.getElementById('content').innerHTML = parseMarkdown(savedContent);
                document.getElementById('content').style.display = 'block';
                document.getElementById('editor').style.display = 'none';
            } else {
                showEditor();
            }
        }

        window.addEventListener('hashchange', loadPage);
        document.addEventListener('DOMContentLoaded', loadPage);
    </script>
</body>
</html>
